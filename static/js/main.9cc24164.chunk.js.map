{"version":3,"sources":["utils.js","Point3D.js","Polygon3D.js","Surface3D.js","Marks.js","Camera.js","Surface.js","App.js","index.js"],"names":["readData","data","columns","slice","index_name","map","column","values","row","index","normDataframe","dataframe","scaleColumns","scaleLinear","domain","extent","range","scaleValues","flat","scaleIndex","x","compare","a","b","centroid","Point3D","coordinates","this","y","z","vector","matrix","transformation","multiply","subset","Polygon3D","points","generator","line","point","apply","mean","ans","i","length","p1","p2","Surface3D","df","polygons","coords","j","push","shape","polygon","sort","Marks","camera","colorScale","marks","view","useEffect","selectAll","paths","path","className","d","fill","area","color","colorValue","darker","Camera","initCoordinates","console","log","transformations","gamma","c","cos","s","sin","beta","alpha","trf","angles","center","translate","rotations","_rotateX","_rotateY","_rotateZ","reduce","p","fieldOfView","near","far","tan","Math","PI","initialAngles","Surface","width","height","useState","setAngles","entryPoint","useRef","handleStart","event","current","handleDrag","mod","dragBehaviour","drag","on","select","call","scaleColor","scaleSequential","interpolateViridis","rotate","perspective","scale","transform","App","setDataframe","csv","then","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9cc24164.chunk.js","sourcesContent":["import { extent } from \"d3-array\"\r\nimport { scaleLinear } from \"d3-scale\"\r\n\r\nexport const readData = data => {\r\n    let columns = data.columns.slice(1)\r\n    const index_name = data.columns[0]\r\n\r\n    return {\r\n        columns: columns.map(column => +column),\r\n        values: data.map(row => columns.map(column => +row[column])),\r\n        index: data.map(row => +row[index_name])\r\n    }\r\n}\r\n\r\nexport const normDataframe = dataframe => {\r\n    // values are inverted\r\n    const scaleColumns = scaleLinear().domain(extent(dataframe.columns)).range([-1, 1])\r\n    const scaleValues = scaleLinear().domain(extent(dataframe.values.flat())).range([1, -1])\r\n    const scaleIndex = scaleLinear().domain(extent(dataframe.index)).range([-1, 1])\r\n\r\n    return {\r\n        columns: dataframe.columns.map(x => scaleColumns(x)),\r\n        values: dataframe.values.map(row => row.map(x => scaleValues(x))),\r\n        index: dataframe.index.map(x=> scaleIndex(x)),\r\n    }\r\n}\r\n\r\nexport const linspace = (start, stop, num, endpoint = true) => {\r\n    const div = endpoint ? (num - 1) : num;\r\n    const step = (stop - start) / div;\r\n    return Array.from({ length: num }, (_, i) => start + step * i);\r\n}\r\n\r\nexport const compare = (a, b) => {\r\n    const coord = 'y'\r\n\r\n    if (a.centroid[coord] < b.centroid[coord]) return +1\r\n    if (a.centroid[coord] > b.centroid[coord]) return -1\r\n    return 0\r\n}\r\n","import { matrix, multiply, index } from 'mathjs';\r\n\r\nexport class Point3D {\r\n    constructor(coordinates) {\r\n        // original coordinates\r\n        this.coordinates = coordinates\r\n\r\n        const [x, y, z] = coordinates\r\n        // mutable coordinates\r\n        this.vector = matrix([\r\n            [x],\r\n            [y],\r\n            [z],\r\n            [1],\r\n        ])\r\n    }\r\n\r\n    apply(transformation) {\r\n        this.vector = multiply(transformation, this.vector)\r\n\r\n        return this\r\n    }\r\n\r\n    get x() {\r\n        return this.vector.subset(index(0, 0)) / this.vector.subset(index(3, 0))\r\n    }\r\n\r\n    get y() {\r\n        return this.vector.subset(index(1, 0)) / this.vector.subset(index(3, 0))\r\n    }\r\n\r\n    get z() {\r\n        return this.vector.subset(index(2, 0)) / this.vector.subset(index(3, 0))\r\n    }\r\n}","import { mean } from 'mathjs'\r\nimport { line } from 'd3'\r\n\r\nimport { Point3D } from './Point3D'\r\n\r\nexport class Polygon3D {\r\n    constructor(points, generator = line()) {\r\n        this.points = points.map(point => new Point3D(point))\r\n        this.generator = generator\r\n    }\r\n\r\n    apply(transformation) {\r\n        this.points = this.points.map(point => point.apply(transformation))\r\n        return this\r\n    }\r\n\r\n    get centroid() {\r\n        return {\r\n            x: mean(this.points.map(point => point.x)),\r\n            y: mean(this.points.map(point => point.y)),\r\n            z: mean(this.points.map(point => point.z))\r\n        }\r\n    }\r\n\r\n    get area() {\r\n        let ans = 0\r\n        const points = [...this.points, this.points[0]]\r\n\r\n        for (let i = 0; i < points.length - 1; i++) {\r\n\r\n            let p1 = points[i]\r\n            let p2 = points[i + 1]\r\n\r\n            ans += (p2.x - p1.x) * (p2.z + p1.z)\r\n        }\r\n\r\n        return ans\r\n    }\r\n\r\n    get data() {\r\n        // orthogonal projection\r\n        return this.generator(this.points.map(point => [point.x, point.z]))\r\n    }\r\n\r\n    get colorValue() {\r\n        // mean of original z-values\r\n        return mean(this.points.map(point => point.coordinates[2]))\r\n    }\r\n}","import { mean } from 'mathjs'\r\n\r\nimport { Polygon3D } from './Polygon3D'\r\nimport { compare } from './utils'\r\n\r\nexport class Surface3D {\r\n    constructor(df) {\r\n        this.df = df\r\n\r\n        this.polygons = [] // paths\r\n\r\n        const coords = (i, j) => [\r\n            df.columns[j], df.index[i], df.values[i][j]\r\n        ]\r\n\r\n        const points = (i, j) => [\r\n            coords(i, j), coords(i, j + 1), coords(i + 1, j + 1), coords(i + 1, j),\r\n        ]\r\n\r\n        for (let i = 0; i < df.index.length - 1; i++) {\r\n            for (let j = 0; j < df.columns.length - 1; j++) {\r\n                this.polygons.push(new Polygon3D(points(i, j)))\r\n            }\r\n        }\r\n    }\r\n\r\n    apply(transformation) {\r\n        this.polygons = this.polygons.map(shape => shape.apply(transformation))\r\n        return this\r\n    }\r\n\r\n    get centroid() {\r\n        return {\r\n            x: mean(this.polygons.map(polygon => polygon.centroid.x)),\r\n            y: mean(this.polygons.map(polygon => polygon.centroid.y)),\r\n            z: mean(this.polygons.map(polygon => polygon.centroid.z))\r\n        }\r\n    }\r\n\r\n    get paths() {\r\n        return this.polygons.sort(compare)\r\n    }\r\n}","import { useEffect } from 'react'\r\nimport { selectAll, color } from 'd3'\r\n\r\nimport { Surface3D } from './Surface3D'\r\n\r\nexport const Marks = ({ df, camera, colorScale }) => {\r\n    let marks = new Surface3D(df)\r\n        .apply(camera.view)\r\n    \r\n    // bind the data to the DOM elemenents\r\n    useEffect(() => selectAll('.marks').data(marks.paths))\r\n\r\n    return marks.paths.map((path, index) => <path\r\n        className='three marks'\r\n        key={index}\r\n        d={path.data}\r\n        fill={path.area > 0 ? color(colorScale(path.colorValue)).darker() : colorScale(path.colorValue)}\r\n    />)\r\n}\r\n","import { matrix, multiply, inv, sin, cos, tan } from 'mathjs'\r\n\r\nexport class Camera {\r\n    constructor(initCoordinates = [0, 0, 0]) {\r\n        console.log('camera')\r\n        //\r\n        const [x, y, z] = initCoordinates\r\n\r\n        //\r\n        this.transformations = matrix([\r\n            [1, 0, 0, x],\r\n            [0, 1, 0, y],\r\n            [0, 0, 1, z],\r\n            [0, 0, 0, 1],\r\n        ])\r\n    }\r\n\r\n    _rotateX(gamma) {\r\n        const c = cos(gamma)\r\n        const s = sin(gamma)\r\n\r\n        return matrix([\r\n            [1, 0, +0, 0],\r\n            [0, c, -s, 0],\r\n            [0, s, +c, 0],\r\n            [0, 0, +0, 1],\r\n        ])\r\n    }\r\n\r\n    _rotateY(beta) {\r\n        const c = cos(beta)\r\n        const s = sin(beta)\r\n\r\n        return matrix([\r\n            [+c, 0, s, 0],\r\n            [+0, 1, 0, 0],\r\n            [-s, 0, c, 0],\r\n            [+0, 0, 0, 1],\r\n        ])\r\n    }\r\n\r\n    _rotateZ(alpha) {\r\n        const c = cos(alpha)\r\n        const s = sin(alpha)\r\n\r\n        return matrix([\r\n            [c, -s, 0, 0],\r\n            [s, +c, 0, 0],\r\n            [0, +0, 1, 0],\r\n            [0, +0, 0, 1],\r\n        ])\r\n    }\r\n\r\n    scale(coordinates) {\r\n        const [x, y, z] = coordinates\r\n\r\n        const trf = matrix([\r\n            [x, 0, 0, 0],\r\n            [0, y, 0, 0],\r\n            [0, 0, z, 0],\r\n            [0, 0, 0, 1],\r\n        ])\r\n\r\n        this.transformations = multiply(trf, this.transformations)\r\n\r\n        return this\r\n    }\r\n\r\n    rotate(angles, center = [0, 0, 0]) {\r\n        this.translate(center.map(c => -c))\r\n\r\n        const rotations = [\r\n            this._rotateX(angles.gamma),\r\n            this._rotateY(angles.beta),\r\n            this._rotateZ(angles.alpha),\r\n        ]\r\n\r\n        const trf = rotations.reduce((p, c) => multiply(p, c))\r\n\r\n        this.transformations = multiply(trf, this.transformations)\r\n\r\n        this.translate(center)\r\n\r\n        return this\r\n    }\r\n\r\n    translate(coordinates) {\r\n        const [x, y, z] = coordinates\r\n\r\n        const trf = matrix([\r\n            [1, 0, 0, x],\r\n            [0, 1, 0, y],\r\n            [0, 0, 1, z],\r\n            [0, 0, 0, 1],\r\n        ])\r\n\r\n        this.transformations = multiply(trf, this.transformations)\r\n\r\n        return this\r\n    }\r\n\r\n    perspective(fieldOfView, near, far) {\r\n        const a = tan(0.5 * (Math.PI - fieldOfView))\r\n        const b = 2 * near * far / (near - far)\r\n        const c = (near + far) / (near - far)\r\n\r\n        const trf = matrix([\r\n            [a, +0, 0, 0],\r\n            [0, +c, 0, b],\r\n            [0, +0, a, 0],\r\n            [0, -1, 0, 0],\r\n        ])\r\n        \r\n        this.transformations = multiply(trf, this.transformations)\r\n\r\n        return this\r\n    }\r\n\r\n    get view() {\r\n        // return inv(this.transformations)\r\n        return this.transformations\r\n    }\r\n}","import { useState, useEffect, useRef } from 'react';\r\nimport { selectAll, select, drag, scaleSequential, interpolateViridis } from 'd3';\r\nimport { mod } from 'mathjs';\r\n\r\n// import { Point3D } from './Point3D';\r\nimport { compare } from './utils';\r\nimport { Marks } from './Marks';\r\nimport { Walls } from './Walls';\r\nimport { Floor } from './Floor';\r\nimport { Camera } from './Camera';\r\n\r\n\r\nconst initialAngles = {\r\n    alpha: Math.PI / 4,\r\n    beta: 0,\r\n    gamma: Math.PI / 4\r\n}\r\n\r\nexport const Surface = ({ df, width, height }) => {\r\n    let [angles, setAngles] = useState(initialAngles)\r\n    let entryPoint = useRef({ x: 0, y: 0 })\r\n    \r\n    // dragging behaviour\r\n    const handleStart = event => {\r\n        entryPoint.current = { x: event.x, y: event.y }\r\n    }\r\n\r\n    const handleDrag = event => setAngles({\r\n        alpha: mod(angles.alpha - (event.x - entryPoint.current.x) / 300 * Math.PI, 2 * Math.PI),\r\n        beta: angles.beta,\r\n        gamma: mod(angles.gamma + (event.y - entryPoint.current.y) / 300 * Math.PI, 2 * Math.PI)\r\n    })\r\n\r\n    useEffect(() => {\r\n        const dragBehaviour = drag()\r\n            .on('start', handleStart)\r\n            .on('drag', handleDrag)\r\n            .on('end', event => console.log('end'))\r\n\r\n        select('svg').call(dragBehaviour)\r\n\r\n        selectAll('.three').sort(compare)\r\n    })\r\n\r\n    // objects NOTE: creating new objects for every render might lead to performance issues\r\n    const scaleColor = scaleSequential(interpolateViridis).domain([1, -1])\r\n\r\n    let camera = new Camera()\r\n        .rotate(angles)\r\n        .translate([0, -10, 0])\r\n        .perspective(Math.PI / 8, 1, 200)\r\n        .scale([300, 300, 300])\r\n        // .scale([100, -100, 100])\r\n\r\n    return (\r\n        <svg width={width} height={height}>\r\n            <g transform={`translate(${width / 2}, ${height / 2})`}>\r\n                {/* <Floor df={df} camera={camera} /> */}\r\n                {/* <Walls df={df} camera={camera} angles={angles} /> */}\r\n                <Marks df={df} camera={camera} colorScale={scaleColor}/>\r\n            </g>\r\n            {/* <text x={10} y={10}>Alpha: {angles.alpha}</text>\r\n            <text x={10} y={30}>Beta: {angles.beta}</text>\r\n            <text x={10} y={50}>Gamma: {angles.gamma}</text> */}\r\n        </svg>\r\n    )\r\n}","import { useState, useEffect } from 'react';\nimport { csv } from 'd3';\n\nimport { Surface } from './Surface'\nimport { readData, normDataframe } from './utils'\n\n\nconst url = 'https://raw.githubusercontent.com/kmatolcsy/options/master/2021-04-16/implied_vols_parametric_dfw.csv'\n\nexport const App = () => {\n  let [dataframe, setDataframe] = useState(null)\n\n  // before rendering\n  useEffect(() => csv(url).then(readData).then(normDataframe).then(setDataframe), [])\n\n  if (!dataframe)\n    return 'Loading...'\n\n  console.log(dataframe)\n\n  return (\n    <div>\n      <Surface df={dataframe} width={900} height={600} />\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}